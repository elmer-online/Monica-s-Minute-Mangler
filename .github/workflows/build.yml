name: Build Windows Executable

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Node
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Rust
      uses: dtolnay/rust-toolchain@stable
    
    - name: Install dependencies
      run: npm install
    
    - name: Build Tauri app
      run: npm run tauri build
    
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: MonicasMinuteMangler-Windows
        path: src-tauri/target/release/bundle/nsis/*.exe
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v2.0.${{ github.run_number }}
        name: Monica's Minute Mangler v2.0.${{ github.run_number }} (Tauri)
        body: |
          ## ğŸ‰ Now with Tauri!
          Download `MonicasMinuteMangler_1.0.0_x64-setup.exe` below - it's only ~5MB!
          
          ## Features
          - ğŸ©· Beautiful glassmorphism timer with beating heart
          - â±ï¸ Click heart to add 5 minutes
          - ğŸ”” Screen flash + sound alert when timer ends
          - ğŸ“Œ Always on top mode
        files: src-tauri/target/release/bundle/nsis/*.exe
        draft: false
        prerelease: false
